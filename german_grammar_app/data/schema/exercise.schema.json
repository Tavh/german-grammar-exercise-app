{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "title": "German Grammar Exercise Schema",
  "description": "Schema for pre-built German grammar exercises. All exercises are data, not generated.",
  "required": [
    "id",
    "level",
    "verb",
    "checklist_item",
    "task_type",
    "prompt",
    "example_solutions",
    "english",
    "hint"
  ],
  "properties": {
    "id": {
      "type": "string",
      "description": "Unique identifier for the exercise"
    },
    "level": {
      "type": "string",
      "enum": ["A2.1", "A2.2", "B1.1", "B1.2"],
      "description": "CEFR level for this exercise"
    },
    "verb": {
      "type": "string",
      "description": "The verb this exercise focuses on"
    },
    "checklist_item": {
      "type": "string",
      "enum": ["kasus", "trennbar", "praeposition", "reflexiv", "partizip_ii"],
      "description": "The grammar dimension being tested"
    },
    "task_type": {
      "type": "string",
      "enum": ["fill_blank", "multiple_choice", "reorder", "sentence_construction"],
      "description": "Type of exercise task"
    },
    "prompt": {
      "type": "string",
      "description": "The task description. Must NOT reveal the full solution. Describes what the user should produce (e.g., 'Form a sentence with anrufen (Pr√§sens).' or 'Fill in the blank: Ich helfe ___ Freund.')."
    },
    "example_solutions": {
      "type": "array",
      "items": {"type": "string"},
      "minItems": 1,
      "description": "Example solutions (1-3 canonical examples). These are hidden by default and shown only when user clicks 'Show example solution(s)'. Must contain full solved sentences/examples."
    },
    "choices": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Available choices for multiple_choice tasks"
    },
    "english": {
      "type": "string",
      "description": "English translation of the sentence"
    },
    "hint": {
      "type": "string",
      "description": "Pedagogical hint for the learner"
    },
    "construction_hints": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Optional scaffolding hints for sentence_construction tasks. May include: subject hints (du, wir, der Lehrer), noun hints WITHOUT case/article resolution, context hints (at school, yesterday). Must NOT include: full noun phrases with articles, resolved cases, solved verb placement."
    },
    "structural_hints": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Optional structural role hints for full sentence construction exercises. Describes roles and structure, NOT declined forms. Allowed: Subjekt (e.g., 'ich', 'er', 'der Mann'), Objekt (e.g., 'Film', 'Song', 'Freund'), Ort (e.g., 'zu Hause', 'im Kino'), Zeit (e.g., 'heute', 'morgen'), Kasus (e.g., 'Akkusativ', 'Dativ'), Genus (e.g., 'm', 'f', 'n'), 'mit Adjektiv' / 'ohne Adjektiv', 'trennbares Verb'. NOT allowed: declined articles (einen, dem), declined adjectives (guten, neuen), solved word order."
    },
    "tags": {
      "type": "array",
      "items": {"type": "string"},
      "description": "Optional tags for categorization"
    }
  },
  "allOf": [
    {
      "if": {
        "properties": {"task_type": {"const": "multiple_choice"}}
      },
      "then": {
        "required": ["choices"]
      }
    }
  ]
}

